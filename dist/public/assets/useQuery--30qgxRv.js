var t,e,s,i,r,n,a,o,h,l,u,c,d,p,f,v,b,y,R,m,g,w,O,C,k,M,E=t=>{throw TypeError(t)},x=(t,e,s)=>e.has(t)||E("Cannot "+s),S=(t,e,s)=>(x(t,e,"read from private field"),s?s.call(t):e.get(t)),W=(t,e,s)=>e.has(t)?E("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),U=(t,e,s,i)=>(x(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),Q=(t,e,s)=>(x(t,e,"access private method"),s);import{e as T,v as F,w as I,f as _,x as D,k as P,y as q,z as L,A,C as j,D as B,E as H,F as z,n as G,r as J,l as K,i as N}from"./index-BQPjUt4N.js";var V=(M=class extends T{constructor(b,y){super(),W(this,v),W(this,t),W(this,e),W(this,s),W(this,i),W(this,r),W(this,n),W(this,a),W(this,o),W(this,h),W(this,l),W(this,u),W(this,c),W(this,d),W(this,p),W(this,f,new Set),this.options=y,U(this,t,b),U(this,o,null),U(this,a,F()),this.bindMethods(),this.setOptions(y)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(S(this,e).addObserver(this),X(S(this,e),this.options)?Q(this,v,b).call(this):this.updateResult(),Q(this,v,g).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Y(S(this,e),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Y(S(this,e),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Q(this,v,w).call(this),Q(this,v,O).call(this),S(this,e).removeObserver(this)}setOptions(s){const i=this.options,r=S(this,e);if(this.options=S(this,t).defaultQueryOptions(s),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof I(this.options.enabled,S(this,e)))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Q(this,v,C).call(this),S(this,e).setOptions(this.options),i._defaulted&&!_(this.options,i)&&S(this,t).getQueryCache().notify({type:"observerOptionsUpdated",query:S(this,e),observer:this});const n=this.hasListeners();n&&Z(S(this,e),r,this.options,i)&&Q(this,v,b).call(this),this.updateResult(),!n||S(this,e)===r&&I(this.options.enabled,S(this,e))===I(i.enabled,S(this,e))&&D(this.options.staleTime,S(this,e))===D(i.staleTime,S(this,e))||Q(this,v,y).call(this);const a=Q(this,v,R).call(this);!n||S(this,e)===r&&I(this.options.enabled,S(this,e))===I(i.enabled,S(this,e))&&a===S(this,p)||Q(this,v,m).call(this,a)}getOptimisticResult(s){const a=S(this,t).getQueryCache().build(S(this,t),s),o=this.createResult(a,s);return function(t,e){if(!_(t.getCurrentResult(),e))return!0;return!1}(this,o)&&(U(this,i,o),U(this,n,this.options),U(this,r,S(this,e).state)),o}getCurrentResult(){return S(this,i)}trackResult(t,e){return new Proxy(t,{get:(t,s)=>(this.trackProp(s),null==e||e(s),"promise"===s&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==S(this,a).status||S(this,a).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(t,s))})}trackProp(t){S(this,f).add(t)}getCurrentQuery(){return S(this,e)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(e){const s=S(this,t).defaultQueryOptions(e),i=S(this,t).getQueryCache().build(S(this,t),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(t){var e;return Q(this,v,b).call(this,{...t,cancelRefetch:null==(e=t.cancelRefetch)||e}).then(()=>(this.updateResult(),S(this,i)))}createResult(t,c){var d;const p=S(this,e),f=this.options,v=S(this,i),b=S(this,r),y=S(this,n),R=t!==p?t.state:S(this,s),{state:m}=t;let g,w={...m},O=!1;if(c._optimisticResults){const e=this.hasListeners(),s=!e&&X(t,c),i=e&&Z(t,p,c,f);(s||i)&&(w={...w,...H(m.data,t.options)}),"isRestoring"===c._optimisticResults&&(w.fetchStatus="idle")}let{error:C,errorUpdatedAt:k,status:M}=w;g=w.data;let E=!1;if(void 0!==c.placeholderData&&void 0===g&&"pending"===M){let t;(null==v?void 0:v.isPlaceholderData)&&c.placeholderData===(null==y?void 0:y.placeholderData)?(t=v.data,E=!0):t="function"==typeof c.placeholderData?c.placeholderData(null==(d=S(this,u))?void 0:d.state.data,S(this,u)):c.placeholderData,void 0!==t&&(M="success",g=z(null==v?void 0:v.data,t,c),O=!0)}if(c.select&&void 0!==g&&!E)if(v&&g===(null==b?void 0:b.data)&&c.select===S(this,h))g=S(this,l);else try{U(this,h,c.select),g=c.select(g),g=z(null==v?void 0:v.data,g,c),U(this,l,g),U(this,o,null)}catch(P){U(this,o,P)}S(this,o)&&(C=S(this,o),g=S(this,l),k=Date.now(),M="error");const x="fetching"===w.fetchStatus,W="pending"===M,Q="error"===M,T=W&&x,_=void 0!==g,D={status:M,fetchStatus:w.fetchStatus,isPending:W,isSuccess:"success"===M,isError:Q,isInitialLoading:T,isLoading:T,data:g,dataUpdatedAt:w.dataUpdatedAt,error:C,errorUpdatedAt:k,failureCount:w.fetchFailureCount,failureReason:w.fetchFailureReason,errorUpdateCount:w.errorUpdateCount,isFetched:w.dataUpdateCount>0||w.errorUpdateCount>0,isFetchedAfterMount:w.dataUpdateCount>R.dataUpdateCount||w.errorUpdateCount>R.errorUpdateCount,isFetching:x,isRefetching:x&&!W,isLoadingError:Q&&!_,isPaused:"paused"===w.fetchStatus,isPlaceholderData:O,isRefetchError:Q&&_,isStale:$(t,c),refetch:this.refetch,promise:S(this,a),isEnabled:!1!==I(c.enabled,t)};if(this.options.experimental_prefetchInRender){const e=void 0!==D.data,s="error"===D.status&&!e,i=t=>{s?t.reject(D.error):e&&t.resolve(D.data)},r=()=>{const t=U(this,a,D.promise=F());i(t)},n=S(this,a);switch(n.status){case"pending":t.queryHash===p.queryHash&&i(n);break;case"fulfilled":(s||D.data!==n.value)&&r();break;case"rejected":s&&D.error===n.reason||r()}}return D}updateResult(){const t=S(this,i),s=this.createResult(S(this,e),this.options);if(U(this,r,S(this,e).state),U(this,n,this.options),void 0!==S(this,r).data&&U(this,u,S(this,e)),_(s,t))return;U(this,i,s);Q(this,v,k).call(this,{listeners:(()=>{if(!t)return!0;const{notifyOnChangeProps:e}=this.options,s="function"==typeof e?e():e;if("all"===s||!s&&!S(this,f).size)return!0;const r=new Set(null!=s?s:S(this,f));return this.options.throwOnError&&r.add("error"),Object.keys(S(this,i)).some(e=>{const s=e;return S(this,i)[s]!==t[s]&&r.has(s)})})()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Q(this,v,g).call(this)}},t=new WeakMap,e=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakMap,n=new WeakMap,a=new WeakMap,o=new WeakMap,h=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,v=new WeakSet,b=function(t){Q(this,v,C).call(this);let s=S(this,e).fetch(this.options,t);return(null==t?void 0:t.throwOnError)||(s=s.catch(P)),s},y=function(){Q(this,v,w).call(this);const t=D(this.options.staleTime,S(this,e));if(q||S(this,i).isStale||!L(t))return;const s=A(S(this,i).dataUpdatedAt,t)+1;U(this,c,j.setTimeout(()=>{S(this,i).isStale||this.updateResult()},s))},R=function(){var t;return null!=(t="function"==typeof this.options.refetchInterval?this.options.refetchInterval(S(this,e)):this.options.refetchInterval)&&t},m=function(t){Q(this,v,O).call(this),U(this,p,t),!q&&!1!==I(this.options.enabled,S(this,e))&&L(S(this,p))&&0!==S(this,p)&&U(this,d,j.setInterval(()=>{(this.options.refetchIntervalInBackground||B.isFocused())&&Q(this,v,b).call(this)},S(this,p)))},g=function(){Q(this,v,y).call(this),Q(this,v,m).call(this,Q(this,v,R).call(this))},w=function(){S(this,c)&&(j.clearTimeout(S(this,c)),U(this,c,void 0))},O=function(){S(this,d)&&(j.clearInterval(S(this,d)),U(this,d,void 0))},C=function(){const i=S(this,t).getQueryCache().build(S(this,t),this.options);if(i===S(this,e))return;const r=S(this,e);U(this,e,i),U(this,s,i.state),this.hasListeners()&&(null==r||r.removeObserver(this),i.addObserver(this))},k=function(s){G.batch(()=>{s.listeners&&this.listeners.forEach(t=>{t(S(this,i))}),S(this,t).getQueryCache().notify({query:S(this,e),type:"observerResultsUpdated"})})},M);function X(t,e){return function(t,e){return!1!==I(e.enabled,t)&&void 0===t.state.data&&!("error"===t.state.status&&!1===e.retryOnMount)}(t,e)||void 0!==t.state.data&&Y(t,e,e.refetchOnMount)}function Y(t,e,s){if(!1!==I(e.enabled,t)&&"static"!==D(e.staleTime,t)){const i="function"==typeof s?s(t):s;return"always"===i||!1!==i&&$(t,e)}return!1}function Z(t,e,s,i){return(t!==e||!1===I(i.enabled,t))&&(!s.suspense||"error"!==t.state.status)&&$(t,s)}function $(t,e){return!1!==I(e.enabled,t)&&t.isStaleByTime(D(e.staleTime,t))}var tt=J.createContext(!1);tt.Provider;var et=J.createContext(function(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}()),st=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function it(t,e,s){var i,r,n,a;const o=J.useContext(tt),h=J.useContext(et),l=N(),u=l.defaultQueryOptions(t);null==(r=null==(i=l.getDefaultOptions().queries)?void 0:i._experimental_beforeQuery)||r.call(i,u);const c=l.getQueryCache().get(u.queryHash);u._optimisticResults=o?"isRestoring":"optimistic",(t=>{if(t.suspense){const e=1e3,s=t=>"static"===t?t:Math.max(null!=t?t:e,e),i=t.staleTime;t.staleTime="function"==typeof i?(...t)=>s(i(...t)):s(i),"number"==typeof t.gcTime&&(t.gcTime=Math.max(t.gcTime,e))}})(u),((t,e,s)=>{const i=(null==s?void 0:s.state.error)&&"function"==typeof t.throwOnError?K(t.throwOnError,[s.state.error,s]):t.throwOnError;(t.suspense||t.experimental_prefetchInRender||i)&&(e.isReset()||(t.retryOnMount=!1))})(u,h,c),(t=>{J.useEffect(()=>{t.clearReset()},[t])})(h);const d=!l.getQueryCache().get(u.queryHash),[p]=J.useState(()=>new e(l,u)),f=p.getOptimisticResult(u),v=!o&&!1!==t.subscribed;if(J.useSyncExternalStore(J.useCallback(t=>{const e=v?p.subscribe(G.batchCalls(t)):P;return p.updateResult(),e},[p,v]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),J.useEffect(()=>{p.setOptions(u)},[u,p]),((t,e)=>(null==t?void 0:t.suspense)&&e.isPending)(u,f))throw st(u,p,h);if((({result:t,errorResetBoundary:e,throwOnError:s,query:i,suspense:r})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(r&&void 0===t.data||K(s,[t.error,i])))({result:f,errorResetBoundary:h,throwOnError:u.throwOnError,query:c,suspense:u.suspense}))throw f.error;if(null==(a=null==(n=l.getDefaultOptions().queries)?void 0:n._experimental_afterQuery)||a.call(n,u,f),u.experimental_prefetchInRender&&!q&&((t,e)=>t.isLoading&&t.isFetching&&!e)(f,o)){const t=d?st(u,p,h):null==c?void 0:c.promise;null==t||t.catch(P).finally(()=>{p.updateResult()})}return u.notifyOnChangeProps?f:p.trackResult(f)}function rt(t,e){return it(t,V)}export{rt as u};
